{% extends 'base.html' %}
{% block title %}Trivia{% endblock %}

{% block content %}

<div class="container w-100">
  <div class="border-0 card box box-shadow bg-white rounded mx-auto mt-5" style="width:30rem;">
    <div class="card-header p-4 border-0">
      <h2 class="text-teal mt-2">Welcome, <b>{{ user.username }}</b></h2>
      <div class="float-right" style="margin-top: -2.4rem">
        <a style="color:grey; text-decoration:none" href="../logout">Logout</a>
      </div>
    </div>
    <div class="card-body text-center pl-3 pb-5">
      <div class="h2 text-muted mx-auto p-4">Finding opponent</div>
      <div class="lds-hourglass"></div>
      <p><button class="btn btn-lg text-white mt-5" id="cancel">Cancel</button></p>
    </div>
  </div>
</div>

<script>
  var playerid = -1

  function findGame() {
    $.post( "../api/findgame/")
    .done(function(data) {
      playerid = data.playerid
      if (data.status == 0) {
        setInterval(function(){ 
            $.post( "../api/gameinfo/", {pid : data.playerid})
            .done(function(info) {
              if (info.status==1) {
                window.location.replace('../game/?pid='+data.playerid)
              }
            });
        }, 800);
      } else if(data.status == 1) {
        window.location.replace('../game/?pid='+data.playerid)
      }
    });
  }

  findGame()

  $('#cancel').click(cancelFind);

  function cancelFind() {
    $.post( "../api/cancelgame/", { playerid: playerid})
    .done(function( data ) {
      if(data.result == 'cancelled') {
        window.location.href = '../'
      }
    });
  }
</script>

{% endblock %}